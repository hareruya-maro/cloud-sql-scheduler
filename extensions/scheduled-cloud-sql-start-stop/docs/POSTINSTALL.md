# Scheduled Cloud SQL Start/Stop

**導入完了！**

この拡張機能が正常にインストールされました。以下が、拡張機能の使い方と詳細情報です。

## 機能概要

この拡張機能は以下の機能を提供します：

- **定期的な起動**: 指定したスケジュール（Cron 式）に基づいて Cloud SQL インスタンスを自動的に起動します。
- **定期的な停止**: 指定したスケジュール（Cron 式）に基づいて Cloud SQL インスタンスを自動的に停止します。
- **休日スキップ機能**: 休日リストや Google カレンダーに基づいて、特定の日にスケジュールをスキップできます。
- **エラー通知**: 起動/停止操作が失敗した場合に Slack へ通知できます。

## 使用方法

この拡張機能は設定に基づいて自動的に動作します。構成設定で指定したスケジュールに従って、
Cloud SQL インスタンスの起動と停止を自動的に行います。

### スケジュールについて

- スケジュールは Cron 式で設定します（例：`0 9 * * 1-5` = 平日の午前 9 時）
- タイムゾーンを指定することで、ローカル時間に合わせて実行できます
- 起動と停止のスケジュールは別々に設定できます

### 休日スキップ設定

休日には自動起動や停止をスキップすることができます。休日は以下の 2 つの方法で設定できます：

1. **休日リスト**: カンマ区切りの日付リスト（YYYY-MM-DD 形式）を指定
2. **Google カレンダー連携**: 指定した Google カレンダーの終日イベントがある日はスキップ

例えば、日本の祝日カレンダーを使用する場合は `ja.japanese#holiday@group.v.calendar.google.com` を指定できます。

## エラー時の Slack 通知

設定で Slack Webhook URL を指定した場合、起動や停止処理に失敗した際に自動的に通知が送信されます。

## トラブルシューティング

問題が発生した場合は、Firebase Functions のログでエラーメッセージを確認してください：

1. [Firebase Console](https://console.firebase.google.com/) へアクセス
2. プロジェクトを選択
3. Functions > ログ を選択
4. `startInstance` または `stopInstance` 関数のログを確認

## 更新と設定変更

拡張機能の設定は後から変更することができます：

1. [Firebase Console](https://console.firebase.google.com/) > 拡張機能セクションへアクセス
2. この拡張機能を選択
3. 「設定」タブをクリック
4. 必要な変更を行い、「変更を保存」をクリック

## よくある質問（FAQ）

### クロンスケジュールの書き方は？

Cron 式は、分・時間・日・月・曜日の 5 つのフィールドからなります。例：

- `0 9 * * 1-5` = 平日の午前 9 時
- `0 18 * * 1-5` = 平日の午後 6 時
- `0 9 * * 1` = 毎週月曜の午前 9 時
- `0 0 1 * *` = 毎月 1 日の午前 0 時

### 休日リストの書き方は？

YYYY-MM-DD 形式でカンマ区切りで指定します。例：
`2025-01-01,2025-01-02,2025-05-05`

### IAM の権限とセキュリティについて

この拡張機能は、Cloud SQL インスタンスの起動と停止のために必要最小限の IAM 権限を使用します。
拡張機能のサービスアカウントには `cloudsql.editor` ロールが付与されています。

### 時間帯/タイムゾーンの設定について

IANA Time Zone Database 形式で指定します。一般的な設定：

- `UTC` = 協定世界時
- `Asia/Tokyo` = 日本時間
- `America/New_York` = ニューヨーク時間
- `Europe/London` = ロンドン時間

## サポートとフィードバック

この拡張機能についてのご質問やフィードバックがありましたら、GitHub Issue を作成してください。
